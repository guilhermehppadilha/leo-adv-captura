---
import { Icon } from 'astro-icon/components'
import AnimateOnScroll from './AnimateOnScroll.astro';

const testimonials = [
  {
    quote: 'O serviço foi excelente, resolveram meu problema em menos de 24 horas. Recomendo a todos que precisam de ajuda!',
    author: 'Ana Costa',
    location: 'Paraná',
    avatar: null,
    rating: 4,
  },
  {
    quote: 'Consegui desbloquear minha conta rapidamente, muito satisfeito com o atendimento!',
    author: 'Carlos Silva',
    location: 'São Paulo',
    avatar: null,
    rating: 5,
  },
  {
    quote: 'Profissionais muito competentes e ágeis. Todo o processo foi online e sem complicações.',
    author: 'Mariana Oliveira',
    location: 'Belo Horizonte',
    avatar: null,
    rating: 5,
  },
    {
    quote: 'Excelentes profissionais e atendimento, conseguiram me ajudar com o desbloqueio do meu salário rapidamente.',
    author: 'Fátima de Paula',
    location: 'Paraná',
    avatar: null,
    rating: 5,
  },
];
---
<section class="bg-white py-24 sm:py-32">
  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <AnimateOnScroll>
      <div class="mx-auto max-w-2xl text-center">
        <h2 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">Avaliações</h2>
        <p class="mt-2 text-lg leading-8 text-gray-600">
          Veja o que nossos clientes dizem sobre nós.
        </p>
      </div>
    </AnimateOnScroll>

    <AnimateOnScroll>
      <div class="embla mx-auto mt-16 max-w-2xl lg:max-w-4xl relative">
        <div class="embla__container">
          {testimonials.map(testimonial => (
            <div class="embla__slide">
              <figure class="rounded-2xl bg-slate-100 p-8 text-sm leading-6 h-full">
                <blockquote class="text-gray-900 flex flex-col h-full">
                  <div class="flex items-center text-yellow-400">
                    {Array.from({ length: testimonial.rating }).map(() => <Icon name='star' class="w-4 h-4" />)}
                  </div>
                  <p class="mt-4 flex-grow">"{testimonial.quote}"</p>
                  <figcaption class="mt-6 flex items-center gap-x-4">
                    {testimonial.avatar ? (
                      <img class="h-14 w-14 rounded-full bg-gray-600" src={testimonial.avatar} alt={`Avatar de ${testimonial.author}`} />
                    ) : (
                      <div class="h-14 w-14 rounded-full bg-slate-200 flex items-center justify-center">
                        <Icon name='avatar' class="w-10 h-10 text-slate-500" />
                      </div>
                    )}
                    <div>
                      <div class="font-semibold text-gray-900">{testimonial.author}</div>
                      <div class="text-gray-600">{testimonial.location}</div>
                    </div>
                  </figcaption>
                </blockquote>
              </figure>
            </div>
          ))}
        </div>
        
        <button class="embla__prev absolute top-1/2 -translate-y-1/2 left-0 -translate-x-12 p-2 rounded-full bg-slate-100 hover:bg-slate-200 transition-colors hidden lg:block" aria-label="Avaliação anterior">
          <svg class="w-6 h-6 text-slate-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
        </button>
        <button class="embla__next absolute top-1/2 -translate-y-1/2 right-0 translate-x-12 p-2 rounded-full bg-slate-100 hover:bg-slate-200 transition-colors hidden lg:block" aria-label="Próxima avaliação">
          <svg class="w-6 h-6 text-slate-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
        </button>
      </div>
    </AnimateOnScroll>
  </div>
</section>

<script>
  import EmblaCarousel from 'embla-carousel';
  import Autoplay from 'embla-carousel-autoplay';

  const emblaNode = document.querySelector('.embla');
  const prevButton = document.querySelector('.embla__prev');
  const nextButton = document.querySelector('.embla__next');

  if (emblaNode) {
    const emblaApi = EmblaCarousel(emblaNode as HTMLElement, { 
      loop: true,
      align: 'start',
      slidesToScroll: 1,
      breakpoints: {
        '(min-width: 1024px)': { slidesToScroll: 2, align: 'center' }
      },
    }, [Autoplay({ delay: 5000, stopOnInteraction: true })]);

    if (prevButton) {
      prevButton.addEventListener('click', () => emblaApi.scrollPrev());
    }
    if (nextButton) {
      nextButton.addEventListener('click', () => emblaApi.scrollNext());
    }
  }
</script>

<style>
  .embla {
    overflow: hidden;
  }
  .embla__container {
    display: flex;
  }
  .embla__slide {
    flex: 0 0 100%;
    min-width: 0;
    padding-left: 1rem;
  }

  @media (min-width: 1024px) {
    .embla__slide {
      flex: 0 0 50%;
    }
  }
</style>